<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hemograma</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  </head>
  <body>
    <div id="exame-info">
      <div id="animal-info">
        <h3>Informações do Animal:</h3>
        <p><strong>Nome:</strong> <span th:text="${animal.nome}"></span></p>
        <p><strong>Sexo:</strong> <span th:text="${animal.sexo}"></span></p>
        <p><strong>Idade:</strong> <span th:text="${animal.idade}"></span></p>
        <p>
          <strong>Esterilização:</strong>
          <span th:text="${animal.esterilizacao}"></span>
        </p>
      </div>

      <div id="medvet-info">
        <h3>Médico Veterinário Responsável:</h3>
        <p><strong>Nome:</strong> <span th:text="${medvet.nome}"></span></p>
        <p><strong>CRMV:</strong> <span th:text="${medvet.crmv}"></span></p>
      </div>

      <div id="cliente-info">
        <h3>Informações do Tutor:</h3>
        <p><strong>Nome:</strong> <span th:text="${cliente.nome}"></span></p>
        <p><strong>CPF:</strong> <span th:text="${cliente.cpf}"></span></p>
        <p>
          <strong>Celular:</strong> <span th:text="${cliente.celular}"></span>
        </p>
      </div>

      <!-- Exibindo as informações do Hemograma -->
      <div id="hemograma-card">
        <h3>
          Ficha do Hemograma: <span th:text="${hemograma.id_hemograma}"></span>
        </h3>
        <p>
          <strong>Hemácias:</strong>
          <span th:text="${hemograma.hemacias}"></span>
        </p>
        <p>
          <strong>Hematócrito:</strong>
          <span th:text="${hemograma.hematocrito}"></span>
        </p>
        <p>
          <strong>Hemoglobina:</strong>
          <span th:text="${hemograma.hemoglobina}"></span>
        </p>
        <p>
          <strong>Leucócitos:</strong>
          <span th:text="${hemograma.leucocitos}"></span>
        </p>
        <p>
          <strong>Linfócitos:</strong>
          <span th:text="${hemograma.linfocitos}"></span>
        </p>
        <p>
          <strong>Plaquetas:</strong>
          <span th:text="${hemograma.plaquetas}"></span>
        </p>
        <p>
          <strong>Observações:</strong>
          <span th:text="${hemograma.observacoes}"></span>
        </p>
      </div>
    </div>

    <button id="download-pdf">PDF</button>

    <script>
      // Script para converter o conteúdo em PDF
      document
        .getElementById("download-pdf")
        .addEventListener("click", function () {
          var element = document.getElementById("exame-info");

          // Para buscar o valor de hemograma.id_hemograma dinamicamente via Thymeleaf
          var hemogramaId = document
            .querySelector("#hemograma-card h3 span")
            .textContent.trim();

          var opt = {
            margin: 0.5,
            filename: "exame_" + hemogramaId + ".pdf",
            html2canvas: {
              scale: 2, // Aumenta a escala para melhor qualidade da imagem
              useCORS: true, // Habilita CORS para imagens externas, se necessário
              logging: true, // Para log de informações durante a geração
              allowTaint: true, // Permite que imagens sejam tainted, se necessário
            },
            jsPDF: {
                unit: 'in',
                format: 'a4', // Formato da página (ex: 'a4', 'letter', etc.)
                orientation: 'portrait' // Orientação da página
              },
            pagebreak: { mode: ["avoid-all", "css", "legacy"] },
          };

          html2pdf().set(opt).from(element).save();
        });
    </script>
  </body>
</html>
